# ЁЯдЦ Order Auto-Approval System Implementation

## рж╕рж┐рж╕рзНржЯрзЗржо ржЖрж░рзНржХрж┐ржЯрзЗржХржЪрж╛рж░ (System Architecture)

ржПржЗ ржбржХрзБржорзЗржирзНржЯрзЗ ржирждрзБржи ржЕрж░рзНржбрж╛рж░ ржЕрзНржпрж╛ржкрзНрж░рзБржнрж╛рж▓ ржУржпрж╝рж╛рж░рзНржХржлрзНрж▓рзЛ рж╕ржорзНржкрзВрж░рзНржгржнрж╛ржмрзЗ ржмрзНржпрж╛ржЦрзНржпрж╛ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред

---

## тЬЕ ржЕрж░рзНржбрж╛рж░ рж▓рж╛ржЗржлрж╕рж╛ржЗржХрзЗрж▓ (Order Lifecycle)

### 1я╕ПтГг **ржкрзЗржирзНржбрж┐ржВ рж╕рзНржЯрзЗржЯ (Pending)** 
- ржЗржЙржЬрж╛рж░ ржпржЦржи ржЧрзНрж░рзБржкрзЗ ржХрзЛржирзЛ рж╕ржВржЦрзНржпрж╛ ржкрж╛ржарж╛ржпрж╝ (ржпрзЗржоржи: 100)
- ржЕрж░рзНржбрж╛рж░ ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ `pending` рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕рзЗ рж╕рзЗржн рж╣ржпрж╝
- ржЕрзНржпрж╛ржбржорж┐ржи ржкрзНржпрж╛ржирзЗрж▓рзЗ ржПржЗ ржЕрж░рзНржбрж╛рж░ `Pending` рж▓рж┐рж╕рзНржЯрзЗ ржжрзЗржЦрж╛ ржпрж╛ржпрж╝

```
ржЗржЙржЬрж╛рж░ ржорзЗрж╕рзЗржЬ: "100"
       тЖУ
DB Status: pending
       тЖУ
Admin Panel: Order appears in "Pending" tab
```

---

### 2я╕ПтГг **ржкрзНрж░рж╕рзЗрж╕рж┐ржВ рж╕рзНржЯрзЗржЯ (Processing)** тП│
- ржЕрзНржпрж╛ржбржорж┐ржи ржпржЦржи ржЕрж░рзНржбрж╛рж░рзЗ рж░рж┐ржкрзНрж▓рж╛ржЗ ржХрж░рзЗ "done" ржмрж▓рзЗ
- ржмрзЛржЯ ржЕрж░рзНржбрж╛рж░ рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕ `pending` ржерзЗржХрзЗ `processing` рждрзЗ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзЗ
- **2 ржорж┐ржирж┐ржЯрзЗрж░ ржЯрж╛ржЗржорж╛рж░ рж╢рзБрж░рзБ рж╣ржпрж╝**
- ржмрзЛржЯ ржПржЗ ржорзЗрж╕рзЗржЬ ржкрж╛ржарж╛ржпрж╝:

```
тП│ *Diamond Order Processing*

ЁЯСд User: [Name]
ЁЯТО Diamonds: 100ЁЯТО
ЁЯТ░ Amount Due: рз│[Amount]
ЁЯУК Rate: рз│[Rate]/ЁЯТО

тП▒я╕П Status: Processing (2 min)
Order ID: [ID]

тЬУ Will auto-approve in 2 minutes
ЁЯУ▒ Delete this message to cancel
```

---

### 3я╕ПтГг **ржЕржЯрзЛ-ржЕрзНржпрж╛ржкрзНрж░рзБржнрж╛рж▓ (Auto-Approval)** ЁЯдЦ
- 2 ржорж┐ржирж┐ржЯ ржкрж░рзЗ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ржнрж╛ржмрзЗ:
  - тЬЕ рж╕рзНржЯржХ ржбрж┐ржбрж╛ржХрзНржЯ рж╣ржпрж╝
  - тЬЕ ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржерзЗржХрзЗ ржЯрж╛ржХрж╛ ржХрж╛ржЯ рж╣ржпрж╝ (ржпржжрж┐ ржкрзНрж░ржпрж╝рзЛржЬржи)
  - тЬЕ ржЕрж░рзНржбрж╛рж░ рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕ `approved` ржП ржкрж░рж┐ржмрж░рзНрждржи рж╣ржпрж╝
  - тЬЕ ржЧрзНрж░рзБржкрзЗ ржЕрзНржпрж╛ржкрзНрж░рзБржнрж╛рж▓ ржорзЗрж╕рзЗржЬ ржкрж╛ржарж╛ржирзЛ рж╣ржпрж╝

```
тЬЕ *Diamond Order AUTO-APPROVED*

ЁЯСд User: [Name]
ЁЯТО Diamonds: 100ЁЯТО
ЁЯТ░ Amount: рз│[Amount]
Order ID: [ID]

тЪб Auto-Deduction Applied
Before: рз│[Before]
Deducted: рз│[Amount]
After: рз│[After]
```

---

### 4я╕ПтГг **ржЕрж░рзНржбрж╛рж░ ржХрзНржпрж╛ржирзНрж╕рзЗрж▓рзЗрж╢ржи** тЭМ

#### ржпржЦржи ржЗржЙржЬрж╛рж░ ржЕрж░рзНржбрж╛рж░ ржбрж┐рж▓рж┐ржЯ ржХрж░рзЗ:
- `pending` рж╕рзНржЯрзЗржЯ ржПрж░ ржЕрж░рзНржбрж╛рж░ ржбрж┐рж▓рж┐ржЯ ржХрж░рж▓рзЗ `deleted` рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕рзЗ ржкрж░рж┐ржмрж░рзНрждржи рж╣ржпрж╝
- ржЕрж░рзНржбрж╛рж░ ржЖрж░ ржкрзНрж░рж╕рзЗрж╕ рж╣ржпрж╝ ржирж╛

#### ржпржЦржи ржЕрзНржпрж╛ржбржорж┐ржи "done" ржорзЗрж╕рзЗржЬ ржбрж┐рж▓рж┐ржЯ ржХрж░рзЗ:
- `processing` рж╕рзНржЯрзЗржЯ ржПрж░ ржЕрж░рзНржбрж╛рж░ ржлрж┐рж░рзЗ `pending` ржП ржпрж╛ржпрж╝
- **2 ржорж┐ржирж┐ржЯрзЗрж░ ржЯрж╛ржЗржорж╛рж░ ржмрж╛рждрж┐рж▓ рж╣ржпрж╝**
- ржЧрзНрж░рзБржкрзЗ ржХрзНржпрж╛ржирзНрж╕рзЗрж▓рзЗрж╢ржи ржорзЗрж╕рзЗржЬ ржкрж╛ржарж╛ржирзЛ рж╣ржпрж╝:

```
тЭМ *Order CANCELLED*

ЁЯТО Order ID: [ID]
ЁЯТО Diamonds: 100ЁЯТО
ЁЯСд User: [Name]

ЁЯУЛ Reason: Admin cancelled the approval
тП╕я╕П Status: Back to Pending
```

---

## ЁЯУБ ржлрж╛ржЗрж▓ ржкрж░рж┐ржмрж░рзНрждржи (Files Modified)

### 1. `config/database.js`
**ржирждрзБржи ржлрж╛ржВрж╢ржи ржпрзЛржЧ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ:**
- `setEntryProcessing(groupId, entryId)` - ржЕрж░рзНржбрж╛рж░ржХрзЗ "processing" рж╕рзНржЯрзЗржЯрзЗ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзЗ

**ржирждрзБржи ржлрж┐рж▓рзНржб ржпрзЛржЧ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ:**
- `processingStartedAt` - ржкрзНрж░рж╕рзЗрж╕рж┐ржВ рж╢рзБрж░рзБрж░ рж╕ржоржпрж╝
- `processingTimeout` - 2 ржорж┐ржирж┐ржЯ ржкрж░рзЗрж░ рж╕ржоржпрж╝
- `cancelledByAdmin` - ржЕрзНржпрж╛ржбржорж┐ржи ржжрзНржмрж╛рж░рж╛ ржмрж╛рждрж┐рж▓ рж╣ржпрж╝рзЗржЫрзЗ ржХрж┐ржирж╛

---

### 2. `utils/auto-approval.js` (ржирждрзБржи ржлрж╛ржЗрж▓)
**ржкрзНрж░ржзрж╛ржи ржлрж╛ржВрж╢ржи:**

```javascript
startAutoApprovalTimer(groupId, orderId, entry, client)
  тЖУ 
  рж╕рзНржЯрж╛рж░рзНржЯ ржХрж░рзЗ 2 ржорж┐ржирж┐ржЯрзЗрж░ ржЯрж╛ржЗржорж╛рж░
  тЖУ
  2 ржорж┐ржирж┐ржЯ ржкрж░рзЗ ржЕржЯрзЛржорзЗржЯрж┐ржХрзНржпрж╛рж▓рж┐:
  - рж╕рзНржЯржХ ржЪрзЗржХ ржХрж░рзЗ
  - ржбрж┐ржбрж╛ржХрзНржЯ ржХрж░рзЗ
  - рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзЗ
  - ржорзЗрж╕рзЗржЬ ржкрж╛ржарж╛ржпрж╝
  - ржЕрзНржпрж╛ржбржорж┐ржи ржкрзНржпрж╛ржирзЗрж▓ржХрзЗ ржирзЛржЯрж┐ржлрж╛ржЗ ржХрж░рзЗ

cancelAutoApprovalTimer(groupId, orderId)
  тЖУ
  ржЯрж╛ржЗржорж╛рж░ ржмрж╛рждрж┐рж▓ ржХрж░рзЗ ржпржжрж┐ ржЕрзНржпрж╛ржбржорж┐ржи "done" ржорзЗрж╕рзЗржЬ ржбрж┐рж▓рж┐ржЯ ржХрж░рзЗ

restoreProcessingTimers(client)
  тЖУ
  ржмрзЛржЯ рж╕рзНржЯрж╛рж░рзНржЯ рж╣ржУржпрж╝рж╛рж░ рж╕ржоржпрж╝ ржпржжрж┐ ржХрзЛржирзЛ pending ржЯрж╛ржЗржорж╛рж░ ржерж╛ржХрзЗ рждрж╛рж╣рж▓рзЗ ржкрзБржирж░рзБржжрзНржзрж╛рж░ ржХрж░рзЗ
```

---

### 3. `index.js` (ржЖржкржбрзЗржЯ)

**ржпрзЛржЧ ржХрж░рж╛ ржЗржоржкрзЛрж░рзНржЯ:**
```javascript
const { startAutoApprovalTimer, cancelAutoApprovalTimer, 
        restoreProcessingTimers, cancelAllTimers } = require('./utils/auto-approval');
```

**ржкрж░рж┐ржмрж░рзНрждржиржЧрзБрж▓рж┐:**

#### ржХ) `client.on('ready')` ржЗржнрзЗржирзНржЯ:
```javascript
client.on('ready', () => {
    // ... existing code ...
    
    // ЁЯдЦ Restore any processing timers on startup
    restoreProcessingTimers(client);
});
```

#### ржЦ) ржЕрж░рзНржбрж╛рж░ ржЕрзНржпрж╛ржкрзНрж░рзБржнрж╛рж▓ рж╣рзНржпрж╛ржирзНржбрж▓рж╛рж░ (admin "done" ржХржорж╛ржирзНржб):
```javascript
if (pendingEntry) {
    // Change to 'processing' instead of 'approved'
    db.setEntryProcessing(groupId, pendingEntry.id);
    
    // Send notification about 2-min auto-approval
    const approvalMsg = `тП│ *Diamond Order Processing*...\n\n` +
        `тЬУ Will auto-approve in 2 minutes\n` +
        `ЁЯУ▒ Delete this message to cancel`;
    
    await replyWithDelay(msg, approvalMsg);
    
    // тЬи START AUTO-APPROVAL TIMER
    startAutoApprovalTimer(groupId, pendingEntry.id, pendingEntry, client);
}
```

#### ржЧ) `client.on('message_revoke')` - ржорзЗрж╕рзЗржЬ ржбрж┐рж▓рж┐ржЯ ржЗржнрзЗржирзНржЯ:
- **ржирждрзБржи ржЪрзЗржХ:** ржпржжрж┐ ржЕрзНржпрж╛ржбржорж┐ржи "done" ржорзЗрж╕рзЗржЬ ржбрж┐рж▓рж┐ржЯ ржХрж░рзЗ
  - ржЕрж░рзНржбрж╛рж░ `processing` ржерзЗржХрзЗ `pending` ржП ржлрзЗрж░ржд ржпрж╛ржпрж╝
  - ржЯрж╛ржЗржорж╛рж░ ржмрж╛рждрж┐рж▓ рж╣ржпрж╝
  - ржЗржЙржЬрж╛рж░ржХрзЗ ржирзЛржЯрж┐ржлрж┐ржХрзЗрж╢ржи ржкрж╛ржарж╛ржирзЛ рж╣ржпрж╝

- **ржмрж┐ржжрзНржпржорж╛ржи ржЪрзЗржХ:** ржпржжрж┐ ржЗржЙржЬрж╛рж░ ржЕрж░рзНржбрж╛рж░ ржорзЗрж╕рзЗржЬ ржбрж┐рж▓рж┐ржЯ ржХрж░рзЗ
  - ржЕрж░рзНржбрж╛рж░ `deleted` рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕рзЗ ржпрж╛ржпрж╝

#### ржШ) ржЧрзНрж░рзЗрж╕ржлрзБрж▓ рж╢рж╛ржЯржбрж╛ржЙржи:
```javascript
process.on('SIGTERM', () => {
    cancelAllTimers();  // ржмрзЛржЯ ржмржирзНржз рж╣ржУржпрж╝рж╛рж░ рж╕ржоржпрж╝ рж╕ржм ржЯрж╛ржЗржорж╛рж░ ржмрж╛рждрж┐рж▓
    server.close();
});

process.on('SIGINT', () => {
    cancelAllTimers();
    server.close();
});
```

---

## ЁЯФД ржбрж╛ржЯрж╛ржмрзЗрж╕ рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░ (Database Structure)

ржкрзНрж░рждрж┐ржЯрж┐ ржЕрж░рзНржбрж╛рж░ ржПржирзНржЯрзНрж░рж┐ ржПржЦржи ржПржЗ ржирждрзБржи ржлрж┐рж▓рзНржб рж░рж╛ржЦрзЗ:

```json
{
  "id": 1,
  "userId": "1234567890@c.us",
  "diamonds": 100,
  "rate": 1.5,
  "status": "processing",
  "createdAt": "2025-12-03T10:00:00Z",
  
  // ржирждрзБржи ржлрж┐рж▓рзНржб:
  "processingStartedAt": "2025-12-03T10:05:00Z",
  "processingTimeout": "2025-12-03T10:07:00Z",
  
  // ржмрж╛рждрж┐рж▓ ржХрж░рж╛ рж╣рж▓рзЗ:
  "cancelledByAdmin": true,
  "cancelledAt": "2025-12-03T10:05:30Z",
  "cancelReason": "Admin deleted approval message",
  
  // ржЕрзНржпрж╛ржкрзНрж░рзБржн рж╣рж▓рзЗ:
  "approvedAt": "2025-12-03T10:07:00Z"
}
```

---

## тП▒я╕П ржЯрж╛ржЗржорж╛рж░ ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ (Timer Management)

### рж╕рзНржЯрзЛрж░рзЗржЬ:
ржЯрж╛ржЗржорж╛рж░ржЧрзБрж▓рж┐ ржорзЗржорж░рж┐рждрзЗ рж╕рзНржЯрзЛрж░ ржХрж░рж╛ рж╣ржпрж╝:
```javascript
const processingTimers = {
  "groupId_orderId": timeoutObject,
  "120363...-120363...@g.us_1": TimeoutRef,
  "120363...-120363...@g.us_2": TimeoutRef
};
```

### ржкрзБржирж░рзБржжрзНржзрж╛рж░ рж▓ржЬрж┐ржХ:
ржмрзЛржЯ рж╕рзНржЯрж╛рж░рзНржЯржЖржкрзЗ:
1. ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ `processing` рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕рзЗрж░ рж╕ржм ржЕрж░рзНржбрж╛рж░ ржЦрзБржБржЬрзЗ ржмрзЗрж░ ржХрж░рзЗ
2. ржХржд ржЯрж╛ржЗржо ржкрж╛рж░ рж╣ржпрж╝рзЗржЫрзЗ ржЪрзЗржХ ржХрж░рзЗ
3. ржмрж╛ржХрж┐ ржЯрж╛ржЗржо ржжрж┐ржпрж╝рзЗ ржирждрзБржи ржЯрж╛ржЗржорж╛рж░ рж╢рзБрж░рзБ ржХрж░рзЗ

```
Order created: 10:00
Admin approved: 10:05 тЖТ Timer starts for 2 minutes
Bot crashes: 10:06
Bot restarts: 10:06:30

// ржХржд ржЯрж╛ржЗржо ржкрж╛рж░ рж╣ржпрж╝рзЗржЫрзЗ?
elapsed = 1 min 30 sec
remaining = 2 min - 1 min 30 sec = 30 seconds

// ржирждрзБржи ржЯрж╛ржЗржорж╛рж░ рж╢рзБрж░рзБ рж╣ржпрж╝ 30 рж╕рзЗржХрзЗржирзНржбрзЗрж░ ржЬржирзНржп
```

---

## ЁЯЪА ржХрзАржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ (How It Works)

### ржЙржжрж╛рж╣рж░ржг рзз: рж╕ржлрж▓ ржЕржЯрзЛ-ржЕрзНржпрж╛ржкрзНрж░рзБржнрж╛рж▓

```
10:00:00 - ржЗржЙржЬрж╛рж░: "100" тЖТ Pending
10:05:00 - ржЕрзНржпрж╛ржбржорж┐ржи: "done" тЖТ Processing рж╢рзБрж░рзБ
          тЖУ
          тП│ 2 ржорж┐ржирж┐ржЯрзЗрж░ ржЯрж╛ржЗржорж╛рж░ рж╢рзБрж░рзБ
          
10:07:00 - тП░ ржЯрж╛ржЗржорж╛рж░ рж╢рзЗрж╖ рж╣ржпрж╝
          тЖУ
          тЬЕ рж╕рзНржЯржХ ржбрж┐ржбрж╛ржХрзНржЯ: 10000 тЖТ 9900
          тЬЕ ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржерзЗржХрзЗ ржХрж╛ржЯ
          тЬЕ рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕: Processing тЖТ Approved
          тЬЕ ржЧрзНрж░рзБржкрзЗ ржЕрзНржпрж╛ржкрзНрж░рзБржнрж╛рж▓ ржорзЗрж╕рзЗржЬ ржкрж╛ржарж╛ржирзЛ рж╣ржпрж╝
          тЬЕ ржЕрзНржпрж╛ржбржорж┐ржи ржкрзНржпрж╛ржирзЗрж▓ ржЖржкржбрзЗржЯ рж╣ржпрж╝
```

### ржЙржжрж╛рж╣рж░ржг рзи: ржЕрзНржпрж╛ржбржорж┐ржи ржХрзНржпрж╛ржирзНрж╕рзЗрж▓ ржХрж░рзЗ

```
10:00:00 - ржЗржЙржЬрж╛рж░: "100" тЖТ Pending
10:05:00 - ржЕрзНржпрж╛ржбржорж┐ржи: "done" тЖТ Processing рж╢рзБрж░рзБ
10:05:30 - ржЕрзНржпрж╛ржбржорж┐ржи: Processing ржорзЗрж╕рзЗржЬ ржбрж┐рж▓рж┐ржЯ ржХрж░рзЗ
          тЖУ
          тЭМ ржЯрж╛ржЗржорж╛рж░ ржмрж╛рждрж┐рж▓ рж╣ржпрж╝
          тЭМ рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕: Processing тЖТ Pending
          тЭМ ржЧрзНрж░рзБржкрзЗ ржХрзНржпрж╛ржирзНрж╕рзЗрж▓ ржорзЗрж╕рзЗржЬ
          тЭМ ржЕрж░рзНржбрж╛рж░ ржлрж┐рж░рзЗ Pending ржП
```

### ржЙржжрж╛рж╣рж░ржг рзй: ржЗржЙржЬрж╛рж░ ржбрж┐рж▓рж┐ржЯ ржХрж░рзЗ

```
10:00:00 - ржЗржЙржЬрж╛рж░: "100" тЖТ Pending
10:02:00 - ржЗржЙржЬрж╛рж░: ржЕрж░рзНржбрж╛рж░ ржорзЗрж╕рзЗржЬ ржбрж┐рж▓рж┐ржЯ ржХрж░рзЗ
          тЖУ
          тЭМ рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕: Pending тЖТ Deleted
          тЭМ ржЕрж░рзНржбрж╛рж░ ржЖрж░ ржкрзНрж░рж╕рзЗрж╕ рж╣ржпрж╝ ржирж╛
```

---

## ЁЯЫбя╕П ржПрж░рж░ рж╣рзНржпрж╛ржирзНржбрж▓рж┐ржВ (Error Handling)

### рж╕рзНржЯржХ ржЕржкрж░рзНржпрж╛ржкрзНржд рж╣рж▓рзЗ:
```
Timer expires at 2 min
тЖУ
Check stock тЖТ Not enough diamonds
тЖУ
Cancel auto-approval
Revert to Pending
Send error message: "ржЕрзНржпрж╛ржбржорж┐ржирзЗрж░ ржХрж╛ржЫрзЗ ржпржерзЗрж╖рзНржЯ ржбрж╛ржпрж╝ржоржирзНржб ржирзЗржЗ"
```

### ржирзЗржЯржУржпрж╝рж╛рж░рзНржХ ржЗрж╕рзНржпрзБ:
```
All network calls have timeout (3 seconds)
If fails тЖТ Continue processing (doesn't break flow)
If admin panel offline тЖТ Still approves locally
```

---

## ЁЯУК ржЕрзНржпрж╛ржбржорж┐ржи ржкрзНржпрж╛ржирзЗрж▓ ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи

ржкрзНрж░рждрж┐ржЯрж┐ ржЕрзНржпрж╛ржХрж╢ржирзЗ ржЕрзНржпрж╛ржбржорж┐ржи ржкрзНржпрж╛ржирзЗрж▓ржХрзЗ ржирзЛржЯрж┐ржлрж╛ржЗ ржХрж░рж╛ рж╣ржпрж╝:

```javascript
// ржЕржЯрзЛ-ржЕрзНржпрж╛ржкрзНрж░рзБржнрж╛рж▓ рж╣ржУржпрж╝рж╛рж░ рж╕ржоржпрж╝
{
  type: 'order-auto-approved',
  groupId: '120363...-120363...@g.us',
  orderId: 1,
  autoDeductedAmount: 150,
  message: 'ЁЯдЦ Order 1 auto-approved'
}

// ржЕрзНржпрж╛ржбржорж┐ржи ржХрзНржпрж╛ржирзНрж╕рзЗрж▓ ржХрж░рж╛рж░ рж╕ржоржпрж╝
{
  type: 'order-cancelled',
  reason: 'admin-deleted-approval',
  groupId: '...',
  orderId: 1,
  message: 'тЭМ Order 1 cancelled by admin'
}
```

---

## тЬи ржмрзИрж╢рж┐рж╖рзНржЯрзНржпржЧрзБрж▓рж┐ (Features)

тЬЕ **Automatic approval after 2 minutes**
тЬЕ **Cancel by deleting approval message**
тЬЕ **Restore timers on bot restart**
тЬЕ **Graceful shutdown with timer cleanup**
тЬЕ **Stock deduction on auto-approval**
тЬЕ **Auto-deduction from user balance**
тЬЕ **Admin panel real-time updates**
тЬЕ **Error handling with fallback**
тЬЕ **Database persistence**
тЬЕ **Timeout handling for network calls**

---

## ЁЯзк ржЯрзЗрж╕рзНржЯрж┐ржВ (Testing)

### ржЯрзЗрж╕рзНржЯ ржХрзЗрж╕ рзз: ржЕржЯрзЛ-ржЕрзНржпрж╛ржкрзНрж░рзБржнрж╛рж▓
```
1. ржЗржЙржЬрж╛рж░ ржЕрж░рзНржбрж╛рж░ ржХрж░рзЗ: "100"
2. ржЕрзНржпрж╛ржбржорж┐ржи: "done"
3. ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржи 2 ржорж┐ржирж┐ржЯ
4. тЬЕ ржЕрж░рзНржбрж╛рж░ ржЕржЯрзЛржорзЗржЯрж┐ржХрзНржпрж╛рж▓рж┐ ржЕрзНржпрж╛ржкрзНрж░рзБржн рж╣ржмрзЗ
```

### ржЯрзЗрж╕рзНржЯ ржХрзЗрж╕ рзи: ржЕрзНржпрж╛ржбржорж┐ржи ржХрзНржпрж╛ржирзНрж╕рзЗрж▓
```
1. ржЗржЙржЬрж╛рж░ ржЕрж░рзНржбрж╛рж░ ржХрж░рзЗ: "100"
2. ржЕрзНржпрж╛ржбржорж┐ржи: "done"
3. ржЕрзНржпрж╛ржбржорж┐ржи Processing ржорзЗрж╕рзЗржЬ ржбрж┐рж▓рж┐ржЯ ржХрж░рзЗ
4. тЬЕ ржЕрж░рзНржбрж╛рж░ Pending ржП ржлрж┐рж░рзЗ ржпрж╛ржмрзЗ
```

### ржЯрзЗрж╕рзНржЯ ржХрзЗрж╕ рзй: ржЗржЙржЬрж╛рж░ ржбрж┐рж▓рж┐ржЯ
```
1. ржЗржЙржЬрж╛рж░ ржЕрж░рзНржбрж╛рж░ ржХрж░рзЗ: "100"
2. ржЗржЙржЬрж╛рж░ ржирж┐ржЬрзЗрж░ ржорзЗрж╕рзЗржЬ ржбрж┐рж▓рж┐ржЯ ржХрж░рзЗ
3. тЬЕ ржЕрж░рзНржбрж╛рж░ Deleted рж╣ржпрж╝рзЗ ржпрж╛ржмрзЗ
```

### ржЯрзЗрж╕рзНржЯ ржХрзЗрж╕ рзк: ржмрзЛржЯ рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ
```
1. ржЗржЙржЬрж╛рж░ ржЕрж░рзНржбрж╛рж░ ржХрж░рзЗ: "100"
2. ржЕрзНржпрж╛ржбржорж┐ржи: "done"
3. ржмрзЛржЯ 30 рж╕рзЗржХрзЗржирзНржб ржкрж░рзЗ рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ рж╣ржпрж╝
4. тЬЕ ржЯрж╛ржЗржорж╛рж░ ржкрзБржирж░рзБржжрзНржзрж╛рж░ рж╣ржмрзЗ (ржмрж╛ржХрж┐ 90 рж╕рзЗржХрзЗржирзНржбрзЗрж░ ржЬржирзНржп)
5. тП░ 90 рж╕рзЗржХрзЗржирзНржб ржкрж░рзЗ ржЕржЯрзЛ-ржЕрзНржпрж╛ржкрзНрж░рзБржн рж╣ржмрзЗ
```

---

## ЁЯУЭ рж▓ржЧ ржЖржЙржЯржкрзБржЯ (Log Output)

```
[PROCESSING] Order ID 1: 100ЁЯТО from User - Will auto-approve in 2 minutes
[AUTO-APPROVAL TIMER] тП▒я╕П Started for Order 1
...
[AUTO-APPROVAL] тП│ 2 minutes elapsed for Order 1, auto-approving...
[STOCK DEDUCTION] тЬЕ Stock updated: 10000 тЖТ 9900
[AUTO-DEDUCT] User: 150 deducted from balance
[AUTO-APPROVAL] тЬЕ Order 1 auto-approved successfully
```

---

## ЁЯОп ржлрж╛ржЗржирж╛рж▓ ржЪрзЗржХрж▓рж┐рж╕рзНржЯ

- тЬЕ `database.js` - ржирждрзБржи ржлрж╛ржВрж╢ржи ржпрзЛржЧ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
- тЬЕ `utils/auto-approval.js` - рждрзИрж░рж┐ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
- тЬЕ `index.js` - рж╕ржм ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи рж╕ржорзНржкржирзНржи
- тЬЕ ржЯрж╛ржЗржорж╛рж░ ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ - рж╕ржорзНржкрзВрж░рзНржг
- тЬЕ ржорзЗрж╕рзЗржЬ ржбрж┐рж▓рж┐ржЯ рж╣рзНржпрж╛ржирзНржбрж▓рж╛рж░ - ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
- тЬЕ ржЧрзНрж░рзЗрж╕ржлрзБрж▓ рж╢рж╛ржЯржбрж╛ржЙржи - ржпрзЛржЧ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
- тЬЕ рж╕рж┐ржиржЯрзНржпрж╛ржХрзНрж╕ ржЪрзЗржХ - ржкрж╛рж╕ ржХрж░рзЗржЫрзЗ тЬУ

---

**рж╕рж┐рж╕рзНржЯрзЗржо ржПржЦржи рж╕ржорзНржкрзВрж░рзНржгржнрж╛ржмрзЗ ржкрзНрж░рж╕рзНрждрзБржд! ЁЯЪА**
